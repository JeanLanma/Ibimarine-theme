<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link rel="stylesheet" href="./normalize.css">
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
      .active-date {
        display: block;
      }
    </style>

</head>
<body>

  
  <h1 class="text-center">Calendarios Dinamicos JS</h1>

  <div id="calendars"></div>

<div></div>

<script>
/* Localization settings */
const locale = 'en';

/**
 * Year & Array with 12 empty slots to save the months with their translations.
 * months constant will help store the translated months 
 * with the native Intl js object below
*/

const actualYear = 2022;
const months = [...Array(12).keys()];


/* Settings to Format JS dates with Localization settings above */
const intlForMonths = new Intl.DateTimeFormat(locale, { month: 'long' })
const intlForWeeks = new Intl.DateTimeFormat(locale, { weekday: 'narrow' })

/**
 * WeekDyas Auto-Translated with Native JS Date Object
 * Formatted with Intl object to help with localization 
*/
const weekDays = [...Array(7).keys()].map((dayIndex) =>
  intlForWeeks.format(new Date(actualYear, 7, dayIndex + 1))
)

/**
 * Get Calendar info to fill HTML calendar with accurate data
*/
const calendar = months.map((monthIndex) => {
  const monthName = intlForMonths.format(new Date(actualYear, monthIndex));
  const nextMonthIndex = (monthIndex + 1) % 12;
  const daysOfMonth = new Date(actualYear, nextMonthIndex, 0).getDate();
  const startsOn = new Date(actualYear, monthIndex, 1).getDay();
  return {
    daysOfMonth,
    monthName,
    startsOn
  }
})

  /**
   * Make The html with accurete and localized information.
  */
const html = calendar.map(({ daysOfMonth, monthName, startsOn }) => {
    const days = [...Array(daysOfMonth).keys()];

    const firstDayAttributes = `class='first-day month-day' style='--first-day-start: ${startsOn}'`;
    
    const htmlDaysName = weekDays
                        .map((dayName) => `<li class='day-name'>${dayName}</li>`)
                        .join('');

    const htmlDays = days
                      .map((day, index) =>
                          `<li ${index === 0 ? firstDayAttributes : 'class="month-day"'}>${day + 1}</li>`
                      )
                      .join('')

    return `
          <div class="calendar-front">
              <div class="calendar__header">
                <div id="calendar-left-arrow"><i class="fa-solid fa-chevron-left"></i></div>
                  <div class="calendar__month_year">
                    <span class="calendar__month text-capitalize">${monthName}</span>
                    <span class="calendar__year">${actualYear}</span>
                  </div>
                <div id="calendar-right-arrow"><i class="fa-solid fa-chevron-right"></i></div>
              </div>
              <div class="calendar__days-container text-color-black-muted">
                <ol class="calendar__days text-bold">
                  ${htmlDaysName}
                </ol>
                <ol class="calendar__days calendar__numberDay text-color-black-muted text-bold">
                  ${htmlDays}
                </ol>
              </div>

          </div>
    `;
    
})
.join('');

/**
 * Finally attaching the previously made calendar to the DOM
*/
document.querySelector('#calendars').innerHTML = html;

// Calendar API to get Selected Date

const calendarElement = document.querySelector('#calendars');
let selectedDate = [];

calendarElement.addEventListener('click', function(e){

    if(e.target.classList.contains('month-day')){
        let isCheked = !e.target.classList.contains('calendar__day-selected') 
                        ? e.target.classList.add('calendar__day-selected')
                        : e.target.classList.remove('calendar__day-selected');
        let day = e.target;
        console.log(getCalendarSelection(day));
    }
})

function getCalendarSelection(day){
    selectedDate = [...selectedDate, getCalendarDate(day)];
    return selectedDate;
}

function getCalendarDate(day){
    const enMonths = {'january':0,'february':1,'march':2,'april':3,'may':4,'june':5,'july':6,'august':7,'september':8,'october':9,'november':10, 'december':11};
    const esMonths = {'enero':0,'febrero':1,'marzo':2,'abril':3,'mayo':4,'junio':5,'julio':6,'agosto':7,'septiembre':8,'octubre':9,'noviembre':10, 'diciembre':11};

    const monthsTranslations = {
      en: enMonths,
      es: esMonths,
    }

    const calendarBase = day.parentElement.parentElement.parentElement;
    const calendar = {
        year: calendarBase.querySelector('.calendar__year').textContent,
        month: calendarBase.querySelector('.calendar__month').textContent,
        day: day.textContent,
        dateFormat: function(){
          return new Date( this.year, monthsTranslations[locale][this.month.toLowerCase()], this.day).toISOString();
        }            
    };
    
    return calendar;
}
        
</script>

    
</body>
</html>